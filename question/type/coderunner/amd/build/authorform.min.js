define(["jquery","qtype_coderunner/userinterfacewrapper"],function(a,b){function c(c){function e(c,d){var e,f,g=a(document.getElementById(c)),h=g.attr("data-lang"),i=g.attr("data-params"),j={};g.attr("data-globalextra",u.val());try{j=JSON.parse(i)}catch(k){}d=d.toLowerCase(),"none"===d&&(d=""),"id_templateparams"==c?e="":(e=w.prop("value"),"id_template"!==c&&x.prop("value")&&(e=m(x.prop("value")))),f=g.data("current-ui-wrapper"),f&&f.uiname===d&&h==e||(g.attr("data-lang",e),f?(j.lang=e,f.loadUi(d,j)):f=new b.InterfaceWrapper(d,c))}function f(){var a=O.val();a&&"html"!==a&&(e("id_answer",a),e("id_answerpreload",a))}function g(a){var b=a?"block":"none";C.css("display",b),D.css("display",b),a&&v.prop("checked")&&e("id_template","ace")}function h(){var a=z.prop("checked");A.prop("disabled",!a),B.prop("disabled",!a)}function i(b,c){var e,f,i;for(var j in d)e=d[j],f=c[j]?c[j]:e[2],e.length>3&&(i=e[3],f=i(f)),a(e[0]).prop(e[1],f);H.prop("value",b),y.prop("checked",!1),J.html(k(b,c.questiontext)),g(!1),h()}function j(a,b){var c;window.alert(l("prototype_load_failure")+b),c=l("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+I+", qtype: "+a,t.prop("value",c)}function k(a,b){var c='<p class="question-type-details-header">';return c+=l("coderunner_question_type"),c+=a+"</p>\n"+b}function l(a){return c[a]}function m(a){var b,c;if(a.indexOf(",")<0)return a;for(b=a.split(","),c=0;c<b.length;c++)if(b[c].endsWith("*"))return b[c].substr(0,b[c].length-1);return b.length>0?b[0]:""}function n(){var b=s.children("option:selected").text();""!==b&&"Undefined"!==b&&(s.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:I,sesskey:M.cfg.sesskey},function(a){a.success?(i(b,a),f()):j(b,a.error)}).fail(function(){window.alert(l("error_loading_prototype")),t.prop("value",l("ajax_error"))}))}function o(){"3"===K.val()?L.show():L.hide()}function p(){"ace"===O.val()&&f()}function q(){v.prop("checked")&&e("id_template","ace")}function r(){var b=N.prop("value"),c=null;""!==b&&(c=a("<p>"+N.prop("value")+"</p>"),a("#id_qtype_coderunner_error_div").append(c))}var s=a("#id_coderunnertype"),t=a("#id_template"),u=a("#id_globalextra"),v=a("#id_useace"),w=a("#id_language"),x=a("#id_acelang"),y=a("#id_customise"),z=a("#id_iscombinatortemplate"),A=a("#id_testsplitterre"),B=a("#id_allowmultiplestdins"),C=a("#id_customisationheader"),D=a("#id_advancedcustomisationheader"),E=y.prop("checked"),F=a("#id_prototypetype"),G=a("#id_answerpreloadhdr"),H=a("#id_typename"),I=a('input[name="courseid"]').prop("value"),J=a("#qtype-help"),K=a("select#id_precheck"),L=a("div.testtype"),N=a("#id_missing_prototype"),O=a("#id_uiplugin");1==F.prop("value")&&(window.alert(l("proceed_at_own_risk")),F.prop("disabled",!0),s.prop("disabled",!0),y.prop("disabled",!0)),r(),g(E),E?(f(),J.html("<p>"+l("info_unavailable")+"</p>")):n(),o(),v.prop("checked")&&e("id_templateparams","ace"),y.on("change",function(){var a=y.prop("checked");a?g(!0):window.confirm(l("confirm_proceed"))?g(!1):y.prop("checked",!0)}),x.on("change",p),w.on("change",function(){q(),p()}),s.on("change",function(){y.prop("checked")&&!window.confirm(l("question_type_changed"))||n()}),v.on("change",function(){var a=v.prop("checked");a?(e("id_template","ace"),e("id_templateparams","ace")):(e("id_template",""),e("id_templateparams",""))}),O.on("change",f),K.on("change",o);var P=new MutationObserver(function(){f()});P.observe(G.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var d={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:c}});